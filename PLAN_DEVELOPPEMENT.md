# üìã PLAN DE D√âVELOPPEMENT - SaaS Call Sheets MVP

> **Objectif** : Construire un MVP fiable permettant de cr√©er, √©diter et envoyer des call sheets professionnelles en PDF
> 
> **Timeline** : 8 semaines | **Stack** : Next.js 15.5 + Supabase + Fly.io + Postmark + Tailwind

---

## üéØ R√àGLES D'OR DU PROJET

- ‚úÖ **Convergence Preview/PDF** : M√™mes composants, m√™mes CSS, m√™mes fonts
- ‚úÖ **Simplicit√© avant tout** : 1 template parfait > 4 moyens
- ‚úÖ **Tests pr√©coces** : Validation utilisateur d√®s la semaine 4
- ‚úÖ **Performance** : PDF g√©n√©r√© en < 10 secondes
- ‚úÖ **S√©curit√©** : RLS strict, URLs sign√©es, tokens courts

---

## üìà √âTAT D'AVANCEMENT GLOBAL

| Phase | Statut | Progression | Fonctionnalit√©s Cl√©s | Date Ach√®vement |
|-------|---------|-------------|----------------------|------------------|
| **Phase 1** | ‚úÖ **Termin√©e** | 100% | Fondations + Auth + UI Base | ‚úÖ Semaine 2 |
| **Phase 2** | ‚úÖ **Termin√©e** | 100% | √âditeur + Preview + Auto-save | ‚úÖ Semaine 4 |
| **Phase 3** | ‚úÖ **Termin√©e** | 95% | PDF + Email + Finalisation | ‚úÖ Semaine 5 |
| **Phase 4** | ‚úÖ **TERMIN√âE** | 100% | **Contacts + Projets + Duplication** | ‚úÖ Semaine 6 |
| **Phase 5** | ‚úÖ **TERMIN√âE** | 100% | **Project Hub + Collaboration + Team** | ‚úÖ Semaine 11 |
| **Phase 6** | ‚è≥ √Ä venir | 0% | Finitions + D√©ploiement | üéØ Semaines 12-13 |

### üéØ **PROGRESSION TOTALE MVP : ~98% TERMIN√â (MVP V1)**

**‚úÖ Phase 4 COMPL√àTEMENT TERMIN√âE ! Tous les succ√®s :**
- ‚úÖ Interface contacts avec toggle Card/Liste
- ‚úÖ CRUD complet (Create, Update, Delete) 
- ‚úÖ Modal s√©lection contacts dans √©diteur
- ‚úÖ Boutons "üìá R√©pertoire" fonctionnels
- ‚úÖ S√©lection multiple de contacts
- ‚úÖ Preview √©quipe tri√©e par d√©partements
- ‚úÖ **Import CSV/Excel avec drag & drop**
- ‚úÖ **Support XLSX, XLS et CSV**
- ‚úÖ **Parsing intelligent multi-formats**
- ‚úÖ **D√©tection automatique colonnes**
- ‚úÖ **Auto-d√©tection d√©partements**
- ‚úÖ **Validation et d√©duplication**
- ‚úÖ **Rapport d'import d√©taill√©**
- ‚úÖ **Gestion projets compl√®te**
- ‚úÖ **Pages /projects avec CRUD**
- ‚úÖ **Page projet /projects/[id] avec call sheets**
- ‚úÖ **Cr√©ation call sheet depuis projet**
- ‚úÖ **Duplication call sheet avec date +1**
- ‚úÖ **Bouton dupliquer dans √©diteur**

**‚úÖ Phase 5 COMPL√àTEMENT TERMIN√âE ! Succ√®s majeurs :**

**üé® Interface & UX :**
- ‚úÖ Interface Desktop Canvas compl√®te (3 colonnes : Tools, Canvas, Preview)
- ‚úÖ Design System coh√©rent (fond noir #0a0a0a, grille pointill√©e)
- ‚úÖ Custom scrollbars et CSS avanc√©
- ‚úÖ Int√©gration Supabase Storage (upload/download/delete r√©els)
- ‚úÖ Syst√®me d'invitations email complet (Postmark)
- ‚úÖ Page acceptation invitation `/invite/[token]`

**üìÅ Gestion de Fichiers Avanc√©e :**
- ‚úÖ Drag & drop d'ic√¥nes sur canvas (comme Windows/macOS)
- ‚úÖ S√©lection multiple (rectangle + Ctrl+Clic)
- ‚úÖ Cr√©ation et gestion de dossiers
- ‚úÖ Drag & drop de fichiers DANS les dossiers
- ‚úÖ Drag & drop de fichiers HORS des dossiers (vers canvas)
- ‚úÖ Renommage inline (comme Windows)
- ‚úÖ Context menu (clic droit) avec actions
- ‚úÖ Auto-arrangement des items (grille fixe)
- ‚úÖ Suppression multiple (Delete key)
- ‚úÖ Positions sauvegard√©es en temps r√©el (Supabase)
- ‚úÖ Table `project_folders` avec positions X/Y

**üìÑ Preview & Visualisation :**
- ‚úÖ Preview sidebar interactive (images, PDF, vid√©os)
- ‚úÖ Modal plein √©cran pour tous les types de fichiers
- ‚úÖ Navigation entre fichiers (fl√®ches gauche/droite)
- ‚úÖ T√©l√©chargement depuis preview
- ‚úÖ **Visualiseur Excel/CSV complet** avec react-data-grid
- ‚úÖ **Mini-preview Excel/CSV dans sidebar** (5 premi√®res lignes)
- ‚úÖ Support multi-feuilles Excel (onglets)
- ‚úÖ Bouton "Agrandir" au hover

**üìã Call Sheets Int√©gration :**
- ‚úÖ Call Sheets affich√©s comme ic√¥nes sur canvas
- ‚úÖ Double-clic ‚Üí ouvre l'√©diteur
- ‚úÖ Cr√©ation depuis "Tools" card
- ‚úÖ Suppression fonctionnelle
- ‚úÖ Fix : Plus de duplication au moment de la cr√©ation

**üéâ Phase 5 - Tous les objectifs atteints :**
- ‚úÖ **Team Management & Invitations Organisation** (TERMIN√â !)
- ‚úÖ **Fix Middleware & Auth avec @supabase/ssr** (TERMIN√â !)
- ‚úÖ **Multi-Level Access Control** (TERMIN√â !)
- ‚úÖ **Invitations Projet Guest** (TERMIN√â !)
- ‚úÖ **Mode Lecture Seule pour Guests** (TERMIN√â !)
- ‚úÖ **RLS Policies sans r√©cursion infinie** (TERMIN√â !)
- ‚úÖ **Tests permissions en conditions r√©elles** (TERMIN√â !)

**‚è≥ Prochaines √©tapes (Phase 6 - Finitions) :**
- ‚è≥ Visualiseurs Word/PowerPoint (Google Docs Viewer)
- ‚è≥ Notifications et activit√© r√©cente
- ‚è≥ Optimisations performances et responsive mobile

---

## üìä PHASES DE D√âVELOPPEMENT

### üèóÔ∏è **PHASE 1 : FONDATIONS (Semaines 1-2)**

#### **Semaine 1 : Setup Projet & Infrastructure**

**üîß Initialisation**
- [x] ~~Cr√©er le monorepo `callsheets-app`~~ ‚Üí **Simplifi√© :** Structure directe dans `calltimes/`
  - [x] ~~`apps/web` (Next.js 15.5)~~ ‚Üí **D√©plac√© :** Application Next.js √† la racine `calltimes/`
  - [ ] `services/pdf-renderer` (Node + Playwright) ‚Üí **√Ä cr√©er plus tard**
- [x] Initialiser Next.js avec App Router + TypeScript
- [x] Installer les d√©pendances principales :
  - [x] `tailwindcss` + `@tailwindcss/typography`
  - [x] `shadcn/ui` (Card, Button, Input, Table, Dialog)
  - [x] `react-hook-form` + `zod`
  - [x] `@supabase/ssr` + `@supabase/supabase-js`
  - [x] `@sentry/nextjs`
  - [x] `react-email` + `@react-email/components`

**üé® Configuration UI**
- [x] Setup Tailwind avec config print CSS
- [x] Installer shadcn/ui avec th√®me sobre
- [x] Cr√©er les tokens CSS pour impression (marges A4, fonts)
- [x] Composant `<A4Page>` de base avec marges fixes

**üîí Supabase Setup**
- [x] Cr√©er projet Supabase
- [x] Configurer Auth (email + magic link)
- [x] Cr√©er buckets Storage : `org-logos`, `project-assets`, `pdfs`
- [x] Variables d'environnement `.env.local`

#### **Semaine 2 : Base de Donn√©es & Auth**

**üóÑÔ∏è Migrations SQL**
- [x] Table `organizations`
- [x] Table `users` 
- [x] Table `memberships` (multi-tenant)
- [x] Table `projects`
- [x] Table `contacts` (simplifi√© sans cat√©gories)
- [x] Table `call_sheets`
- [x] Table `call_sheet_locations`
- [x] Table `call_sheet_schedule`
- [x] Table `call_sheet_team_rows`
- [x] Table `email_jobs` + `email_recipients`

**üîê S√©curit√© RLS**
- [x] Policies RLS pour toutes les tables
- [x] Tests RLS (utilisateur ne voit que son org)
- [x] Helper functions Supabase (get_user_org_id)

**üå± Seeds & Tests**
- [x] Donn√©es de test (orgs, users, contacts)
- [x] Tests auth basiques (signup/login avec mot de passe)
- [x] Flow d'onboarding pour cr√©ation d'organisation
- [ ] Validation des policies RLS

**üì± Shell UI**
- [x] Layout principal avec navigation
- [x] Page `/dashboard` (shell avec donn√©es mock√©es)
- [x] Page `/projects` (MISSION CONTROL avec grille projets + filtres statuts)
- [x] Page `/contacts` (CONTACT DIRECTORY avec filtres d√©partements + recherche)
- [x] Composants UI de base (Header, Sidebar, PageLayout, GridLayout, SectionHeader)
- [x] **Structure simplifi√©e :** Tout d√©plac√© de `apps/web/` vers `calltimes/` directement
- [x] **Application fonctionnelle :** Dashboard accessible sur http://localhost:3000
- [x] **Design System Appliqu√© :** Vocabulaire "command", couleurs fonctionnelles par section
- [x] **Authentification compl√®te :** Signup, Login, Onboarding, Middleware protection
- [x] **Multi-tenant ready :** Organisation auto-cr√©ation, RLS policies actives

---

### ‚úèÔ∏è **PHASE 2 : √âDITEUR & PREVIEW (Semaines 3-4)**

#### **Semaine 3 : √âditeur Core**

**üìù Structure √âditeur**
- [x] Page `/call-sheets/[id]/edit`
- [x] Layout √©diteur : sidebar gauche + preview droite
- [x] Composant `<EditorSidebar>` avec 4 sections :
  - [x] **Section 1** : Informations G√©n√©rales
  - [x] **Section 2** : Planning  
  - [x] **Section 3** : √âquipe
  - [x] **Section 4** : Param√®tres

**üìã Section Informations G√©n√©rales**
- [x] Formulaire React Hook Form + Zod
- [x] Champs : titre, date de tournage, description
- [x] **Gestion des lieux avanc√©e** : Multi-lieux avec nom + adresse + notes
- [x] **Contacts importants** : Cards avec nom + poste + tel + email
- [x] **Interface triple logos** : Production (gauche) + Marque (centre, plus gros) + Agence (droite)
- [x] Notes g√©n√©rales

**‚è∞ Section Planning**
- [x] Liste des horaires (titre + heure texte libre)
- [x] **Quick adds intelligents** : Boutons pr√©d√©finis avec heures sugg√©r√©es
- [x] **Cards √©ditables compl√®tes** : Titre ET heure modifiables
- [x] **Tri automatique par heure** : R√©organisation temps r√©el
- [x] **Validation Zod temps r√©el** : Format HH:MM avec messages d'erreur
- [x] **Boutons Up/Down** : R√©organisation manuelle sans drag & drop
- [x] Boutons Ajouter/Supprimer

#### **Semaine 4 : Preview A4 & √âquipe**

**üë• Section √âquipe**
- [x] **Gestion avanc√©e par d√©partements** : 9 cat√©gories avec couleurs
- [x] **Organisation automatique** : Tri et groupement par d√©partement
- [x] **Ajout manuel complet** : Formulaire 6 champs (nom, poste, dept, call time, tel, email)
- [x] **Boutons r√©pertoire fonctionnels** : Ouverture page contacts en nouvel onglet
- [x] **Boutons Up/Down** : R√©organisation manuelle de l'√©quipe
- [x] **Codes couleur professionnels** : PROD, REGIE, CAM, REAL, HMC, etc.
- [x] Champs : nom, r√¥le, email, t√©l√©phone, call time, d√©partement

**üìÑ Preview A4 Temps R√©el**
- [x] **Template professionnel final** : Header √©pur√© avec 3 logos positionn√©s
- [x] **Structure logique optimis√©e** : Titre ‚Üí Date ‚Üí Lieux ‚Üí Contacts ‚Üí Planning ‚Üí √âquipe ‚Üí Notes
- [x] **CSS print optimis√©** : Marges, typographie, compacit√© PDF
- [x] **Rendu temps r√©el complet** : Toutes sections synchronis√©es
- [x] **Police syst√®me fixe** : Design √©pur√© et professionnel
- [x] **Synchronisation temps r√©el** : Preview se met √† jour instantan√©ment
- [x] **Section CREW CALL dynamique** : Affichage √©quipe par d√©partement
- [ ] Tests multi-navigateurs (Chrome, Firefox, Safari)

**üíæ Auto-Save**
- [x] **Hook `useAutoSave` professionnel** : Debounce 500ms + gestion d'erreurs
- [x] **Sauvegarde automatique** : Mock avec simulation d√©lai (pr√™t pour vraie API)
- [x] **Indicateur de statut dynamique** : Sauvegard√©/En cours/Erreur avec couleurs

**üß™ Tests Convergence**
- [x] Prototype PDF simple pour validation
- [x] Comparaison visuelle preview vs PDF
- [x] Ajustements CSS si n√©cessaire

---

### üìÑ **PHASE 3 : PDF & EMAIL (Semaine 5)**

#### **Service PDF (Fly.io)**

**üê≥ Setup Service**
- [x] Dockerfile pour service PDF (Node + Playwright)
- [x] Configuration Fly.io (`fly.toml`)
- [x] Endpoint `/render?token=...&callSheetId=...`
- [x] **Mode d√©mo fonctionnel** : Fallback avec donn√©es de test + t√©l√©chargement direct
- [ ] Validation token sign√© + TTL (15 minutes)

**üé≠ G√©n√©ration PDF**
- [x] Fetch donn√©es call sheet (Supabase service key)
- [x] Rendu HTML avec m√™mes composants que preview
- [x] Configuration Chromium (A4, marges 12mm)
- [x] Upload PDF vers bucket `pdfs/` (mode production)
- [x] **Convergence Preview/PDF valid√©e** : Diff√©rences < 5% (donn√©es uniquement)
- [x] **T√©l√©chargement automatique** : PDF se t√©l√©charge directement en mode d√©mo

**üìß Int√©gration Email**
- [x] Configuration Postmark (domaine + templates)
- [x] Page `/finalize/[callSheetId]`
- [x] Formulaire envoi : objet, message, destinataires auto
- [x] Envoi PDF en pi√®ce jointe
- [x] **Tests validation r√©ussis** : Restriction domaine Postmark confirm√©e (compte pending)
- [ ] Webhook Postmark pour statut

**üîÑ Gestion Erreurs**
- [ ] Retry automatique (3 tentatives)
- [ ] Notifications utilisateur (toast/alert)
- [ ] Logs d'erreur (Sentry)
- [ ] Fallback si service PDF indisponible

---

### üë• **PHASE 4 : CONTACTS & IMPORT (Semaines 6-7)**

#### **Semaine 6 : CRUD Contacts**

**üìá Interface Contacts**
- [x] **Page `/contacts` am√©lior√©e** : Grille cards + vue liste toggle
- [x] **Filtres avanc√©s** : Recherche temps r√©el (nom/email/t√©l√©phone/r√¥le) + d√©partements
- [x] **CRUD complet** : Create, Read, Update, Delete fonctionnels
- [x] **Modal cr√©ation/√©dition** : Formulaire valid√© (Zod + React Hook Form)
- [x] **Validation formulaire** : Email, t√©l√©phone, champs requis
- [x] **Toggle vue Card/Liste** : Basculement interface pour overview rapide
- [x] **Stats dynamiques** : Compteurs temps r√©el, notifications toast

**üîó Int√©gration √âditeur**
- [x] **S√©lection contacts depuis √©diteur** : Modal d√©di√©e avec recherche/filtres
- [x] **Auto-remplissage √©quipe** : Mapping automatique contact ‚Üí membre √©quipe
- [x] **Boutons r√©pertoire fonctionnels** : "üìá R√©pertoire" ouvre modal s√©lection
- [x] **Modes sp√©cialis√©s** : Important contacts vs Team members
- [x] **S√©lection multiple** : Ajout de plusieurs contacts en une fois
- [x] **Interface optimis√©e** : Cards compactes avec badges color√©s
- [x] **Preview am√©lior√©e** : √âquipe tri√©e par d√©partements avec headers gris√©s
- [x] Conversion ligne manuelle ‚Üí contact permanent
- [x] Gestion des contacts "favoris" ou r√©cents

#### **Semaine 7 : Import CSV & Projets**

**üìä Import CSV/Excel**
- [x] **Interface upload multi-formats** : Drag & drop CSV, XLSX, XLS
- [x] **D√©tection automatique type fichier** : Parser adapt√© selon extension
- [x] **Parsing intelligent CSV** : D√©tection automatique colonnes (name, first/last name, role, job title, email, phone, department, cat√©gorie)
- [x] **Parsing intelligent Excel** : Support colonnes vari√©es (First Name, Last Name, Job Title, Cat√©gorie, etc.)
- [x] **Auto-d√©tection d√©partements** : Depuis colonne explicite OU analyse du r√¥le
- [x] **Validation temps r√©el** : Email, t√©l√©phone, champs requis
- [x] **D√©duplication par email** : D√©tection automatique des doublons
- [x] **Rapport d'import d√©taill√©** : Statistiques (cr√©√©s/ignor√©s/erreurs)
- [x] **Template CSV** : T√©l√©chargement de mod√®le pr√©-format√©
- [x] **UX professionnelle** : Interface intuitive avec feedback visuel

**üìÅ Gestion Projets**
- [x] Page `/projects` avec liste
- [x] CRUD projets basique
- [x] Page projet `/projects/[id]` 
- [x] Liste des call sheets du projet
- [x] Actions : cr√©er call sheet, dupliquer

**üìã Duplication Call Sheet**
- [x] Bouton "Dupliquer" sur call sheet existante
- [x] Copie des donn√©es + date +1 jour
- [x] Modification possible avant sauvegarde

---

### üìÅ **PHASE 5 : PROJECT HUB & COLLABORATION (Semaines 8-10)**

> **Vision** : Transformer les projets en v√©ritables hubs cloud collaboratifs o√π toute l'√©quipe peut consulter et g√©rer les documents de production

#### **Semaine 8 : File Management Core**

**üóÑÔ∏è Base de Donn√©es**
- [x] Migration : Table `project_files` ‚úÖ
  - [x] Colonnes : id, project_id, file_name, file_path, file_type, folder_path ‚úÖ
  - [x] Colonnes : uploaded_by, created_at, file_size, mime_type ‚úÖ
  - [x] RLS policies pour acc√®s s√©curis√© ‚úÖ
- [x] Migration : Table `project_members` ‚úÖ
  - [x] Colonnes : id, project_id, user_id (nullable), email, role ‚úÖ
  - [x] Colonnes : invitation_token, invitation_status, invited_at, accepted_at ‚úÖ
  - [x] RLS policies pour permissions ‚úÖ
- [x] Bucket Supabase Storage : `project-files` avec quotas ‚úÖ

**üì§ Upload de Fichiers**
- [x] Interface drag & drop (react-dropzone) ‚úÖ
- [x] Upload vers Supabase Storage ‚úÖ
- [x] Validation : taille max (100MB), types autoris√©s ‚úÖ
- [x] Progress bar et feedback visuel ‚úÖ
- [x] Gestion d'erreurs (quota d√©pass√©, type invalide) ‚úÖ

**üìã Gestion des Fichiers**
- [x] Liste des fichiers du projet (grid + list view) ‚úÖ
- [x] Affichage : nom, type, taille, date upload, upload√© par ‚úÖ
- [x] Actions : t√©l√©charger, supprimer, renommer ‚úÖ
- [x] Tri et filtres basiques (par type, par date) ‚úÖ
- [x] Search dans les noms de fichiers ‚úÖ

**üñºÔ∏è Pr√©visualisation Basique**
- [x] Preview images (JPG, PNG, GIF, WebP) ‚úÖ
- [x] Preview PDF (structure pr√™te, viewer √† compl√©ter) ‚úÖ
- [x] Modal fullscreen pour viewer ‚úÖ
- [x] Navigation entre fichiers (dans modal) ‚úÖ
- [x] Fallback pour types non support√©s ‚úÖ

#### **Semaine 9 : Interface Hub & Collaboration**

**üé® Page Projet `/projects/[id]` Refonte**
- [x] Layout : Grid 2 colonnes (files principale + sidebar) ‚úÖ
- [x] Card "Files" : Liste/grille des fichiers ‚úÖ
- [x] Card "Tools" : Actions disponibles ‚úÖ
  - [x] Lien vers Call Sheet Editor ‚úÖ
  - [x] Statistiques du projet ‚úÖ
- [x] Card "Team" : Membres du projet ‚úÖ
  - [x] Liste des membres actifs ‚úÖ
  - [x] Bouton "Invite Member" ‚úÖ
  - [x] R√¥les affich√©s (Owner/Editor/Viewer) ‚úÖ
- [x] Header projet : titre, statut, actions rapides ‚úÖ

**üë• Syst√®me d'Invitations**
- [x] Modal "Invite Member" avec champ email + r√¥le ‚úÖ
- [x] G√©n√©ration token d'invitation unique (UUID) ‚úÖ
- [x] Envoi email via Postmark avec lien magique ‚úÖ
- [x] Template email invitation personnalis√© ‚úÖ
- [x] Page `/invite/[token]` pour acceptation ‚úÖ
  - [x] V√©rification token valide (expiration 7 jours) ‚úÖ
  - [x] Cr√©ation compte si nouvel utilisateur ‚úÖ
  - [x] Association au projet ‚úÖ
  - [x] Redirection vers projet apr√®s acceptation ‚úÖ

**üîê Permissions & S√©curit√©**
- [x] R√¥les : Owner (full), Editor (upload/delete), Viewer (read-only) ‚úÖ
- [x] RLS Supabase : v√©rification membre avant acc√®s fichiers ‚úÖ
- [x] URLs sign√©es pour fichiers (Supabase Storage) ‚úÖ
- [ ] Logs d'acc√®s : qui a consult√© quel fichier (optionnel)
- [x] Protection t√©l√©chargement : v√©rification permissions ‚úÖ

#### **Semaine 10 : Advanced Features & Polish**

**üìÅ Organisation par Dossiers**
- [x] Cr√©ation/suppression de dossiers ‚úÖ
- [x] Drag & drop pour d√©placer fichiers DANS dossiers ‚úÖ
- [x] Drag & drop pour sortir fichiers DES dossiers ‚úÖ
- [x] Renommage inline (double-clic) ‚úÖ
- [x] Context menu (clic droit) avec actions ‚úÖ
- [x] Positions X/Y sauvegard√©es en temps r√©el ‚úÖ
- [ ] Navigation breadcrumb (pas n√©cessaire pour desktop canvas)
- [ ] Dossiers par d√©faut sugg√©r√©s

**üîç S√©lection & Navigation**
- [x] S√©lection simple (clic) ‚úÖ
- [x] S√©lection multiple (Ctrl+Clic) ‚úÖ
- [x] S√©lection rectangle (drag) ‚úÖ
- [x] Suppression multiple (Delete key) ‚úÖ
- [x] Auto-arrangement (clic droit ‚Üí Ranger) ‚úÖ
- [x] Navigation entre fichiers (preview modal) ‚úÖ
- [ ] Raccourcis clavier avanc√©s (Cmd+A, Cmd+C/V)
- [ ] Vue liste vs grille (toggle) - Actuellement: desktop canvas uniquement

**üìé Visualiseurs Multi-Formats**
- [x] **Excel/CSV Viewer complet** : react-data-grid, multi-feuilles, scroll virtuel ‚úÖ
- [x] **Mini-preview Excel/CSV** : 5 premi√®res lignes dans sidebar ‚úÖ
- [x] Images : JPG, PNG, GIF, WebP ‚úÖ
- [x] PDF : iframe natif ‚úÖ
- [x] Video player : MP4, MOV (HTML5 video) ‚úÖ
- [x] Audio player : MP3, WAV (HTML5 audio) ‚úÖ
- [ ] Office Viewer : Word, PowerPoint (Google Docs Viewer)
- [ ] Am√©lioration PDF : annotations, zoom, page navigation

**üîî Notifications**
- [ ] Email : nouveau fichier upload√©
- [ ] Email : nouveau membre ajout√©
- [ ] Badge notifications in-app (header)
- [ ] Liste activit√©s r√©centes du projet

**‚ú® UX Polish**
- [x] Loading states pour Excel/CSV ‚úÖ
- [x] Animations : drag & drop, hover effects ‚úÖ
- [x] Empty states : "Aucun fichier" ‚úÖ
- [x] Custom scrollbars (style coh√©rent) ‚úÖ
- [x] Feedback visuel : toasts, bordures s√©lection ‚úÖ
- [ ] Responsive : tablet/mobile friendly
- [ ] Animations d'apparition de fichiers
- [ ] Raccourcis clavier : upload (Cmd+U), search (Cmd+K)

**üß™ Tests & S√©curit√©**
- [x] Tests : upload fichiers volumineux (100MB) ‚úÖ
- [x] Tests : suppression fichiers ‚úÖ
- [x] Tests : d√©placement fichiers (dossiers) ‚úÖ
- [ ] Tests : invitations (acceptation, expiration)
- [ ] Tests : permissions (tentative acc√®s non autoris√©)
- [ ] Tests : suppression cascade (projet ‚Üí fichiers)
- [ ] Tests : quotas storage (limite atteinte)

#### **Semaine 11 : Team Management & Multi-Level Access**

> **Vision** : Syst√®me de collaboration √† 2 niveaux - Membres organisation (acc√®s complet) vs Invit√©s projet (acc√®s restreint lecture seule)

**üë• Invitations Organisation (Victor ‚Üí Simon)** ‚úÖ **TERMIN√â**

**Base de Donn√©es**
- [x] Migration : Table `organization_invitations` ‚úÖ
  - [x] Colonnes : id, organization_id, email, role (owner/member) ‚úÖ
  - [x] Colonnes : invitation_token (UUID), invited_by, status (pending/accepted/expired/revoked) ‚úÖ
  - [x] Colonnes : created_at, expires_at (7 jours), accepted_at ‚úÖ
  - [x] RLS policies pour s√©curit√© ‚úÖ
- [x] Index sur `invitation_token` pour performance ‚úÖ
- [x] Index UNIQUE partiel (seulement pending) pour √©viter doublons ‚úÖ
- [x] Trigger v√©rification limite 20 membres ‚úÖ
- [x] Fonction auto-expiration invitations > 7 jours ‚úÖ

**Interface Team Management**
- [x] Page `/settings/team` nouvelle ‚úÖ
  - [x] Liste des membres organisation actuels ‚úÖ
  - [x] Affichage : nom, email, r√¥le (Owner/Member), date ajout ‚úÖ
  - [x] Badge "You" sur l'utilisateur actuel ‚úÖ
  - [x] Actions : inviter nouveau membre, r√©voquer invitation ‚úÖ
  - [x] Stats dynamiques : Total Members, Pending Invitations, Available Slots ‚úÖ
- [x] Modal "Invite Team Member" ‚úÖ
  - [x] Champ email (validation) ‚úÖ
  - [x] S√©lection r√¥le visuelle : Owner / Member avec ic√¥nes ‚úÖ
  - [x] Info box explicative des r√¥les ‚úÖ
  - [x] Bouton "Send Invitation" ‚úÖ
  - [x] Compteur membres (X / 20) ‚úÖ
- [x] Limite : max 20 membres par organisation (trigger SQL) ‚úÖ
- [x] Empty state : "Vous √™tes seul pour l'instant" ‚úÖ
- [x] Section "Pending Invitations" avec bouton Revoke ‚úÖ

**Email Invitation Organisation**
- [x] Template Postmark "organization-invitation" ‚úÖ
  - [x] Objet : "[Organization] vous invite √† rejoindre Call Times" ‚úÖ
  - [x] Design dark coh√©rent Call Times (noir #111, vert #4ade80) ‚úÖ
  - [x] Contenu : message de bienvenue + CTA "Accept Invitation" ‚úÖ
  - [x] Lien magique vers `/invite/org/[token]` ‚úÖ
  - [x] Expiration : 7 jours (affich√©e dans l'email) ‚úÖ
  - [x] D√©tails : org name, inviter name, role, expiration ‚úÖ
  - [x] Lien alternatif pour copier-coller ‚úÖ
- [x] API Route `/api/invitations/send` (server-side) ‚úÖ
  - [x] G√©n√©ration token unique automatique ‚úÖ
  - [x] Cr√©ation record `organization_invitations` ‚úÖ
  - [x] Envoi email via Postmark (fix CORS) ‚úÖ
  - [x] Logs d√©taill√©s avec emojis pour debugging ‚úÖ
  - [x] Gestion erreurs compl√®te ‚úÖ

**Page Acceptation Invitation Org**
- [x] Route `/invite/org/[token]` ‚úÖ
  - [x] Validation token (existe + non expir√©) ‚úÖ
  - [x] Affichage : nom organisation, r√¥le propos√©, invit√© par ‚úÖ
  - [x] Design professionnel avec cards et badges color√©s ‚úÖ
  - [x] Si user connect√© : acceptation directe (un clic) ‚úÖ
  - [x] Si user non connect√© : formulaire signup ‚úÖ
    - [x] Champs : full_name, password, confirm password ‚úÖ
    - [x] Email pr√©-rempli (disabled) ‚úÖ
    - [x] Validation compl√®te ‚úÖ
    - [x] Cr√©ation compte Supabase Auth + user + membership ‚úÖ
  - [x] Cr√©ation `membership` dans table `memberships` ‚úÖ
  - [x] Update statut invitation ‚Üí `accepted` ‚úÖ
  - [x] Redirection ‚Üí `/dashboard` ‚úÖ
- [x] Gestion erreurs : token invalide/expir√© ‚úÖ
- [x] Toast de bienvenue apr√®s acceptation ‚úÖ
- [x] Fix Logo size bug (medium au lieu de md) ‚úÖ

**Services & Helpers**
- [x] `lib/services/organization-invitations.ts` ‚úÖ
  - [x] `createOrganizationInvitation(orgId, email, role)` ‚úÖ
  - [x] `getOrganizationInvitation(token)` ‚úÖ
  - [x] `acceptOrganizationInvitation(token)` (user connect√©) ‚úÖ
  - [x] `acceptOrganizationInvitationWithSignup(token, fullName, password)` ‚úÖ
  - [x] `revokeOrganizationInvitation(invitationId)` ‚úÖ
  - [x] `listOrganizationMembers(orgId)` (membres + pending) ‚úÖ
  - [x] V√©rifications : owner, pas d√©j√† membre, pas d√©j√† invit√©, limite 20 ‚úÖ
- [x] `lib/services/email-organization-invitation.ts` ‚úÖ
  - [x] `sendOrganizationInvitationEmail()` (appelle API route) ‚úÖ
- [x] `app/api/invitations/send/route.ts` (API server-side) ‚úÖ
  - [x] Fetch invitation depuis Supabase (service key) ‚úÖ
  - [x] Envoi Postmark avec template HTML/Text ‚úÖ
  - [x] Logs d√©taill√©s pour debugging ‚úÖ
- [x] RLS policies pour lecture/√©criture s√©curis√©es ‚úÖ
- [x] Composant `InviteMemberModal` ‚úÖ
- [x] Composant `ui/label.tsx` ‚úÖ

**Onboarding Integration (Future)**
- [ ] Option "Inviter des membres" dans flow onboarding
- [ ] Multi-emails input (comma-separated)
- [ ] Envoi batch invitations apr√®s cr√©ation org
- [ ] Skip si utilisateur pr√©f√®re faire plus tard

---

**üîê Multi-Level Access Control (Victor/Simon vs Philippe)** ‚úÖ **TERMIN√â !**

**D√©tection Type Utilisateur**
- [x] Helper function `getUserAccessType(userId)` ‚úÖ
  - [x] Check `memberships` ‚Üí type: 'org_member' ‚úÖ
  - [x] Check `project_members` ‚Üí type: 'project_guest' ‚úÖ
  - [x] Return : type + metadata (orgId ou projectIds) ‚úÖ
- [x] Middleware protection routes ‚úÖ
  - [x] `/dashboard`, `/projects`, `/contacts`, `/settings/team` ‚Üí org_member only ‚úÖ
  - [x] `/projects/[id]` ‚Üí org_member OR project_guest (si membre projet) ‚úÖ
  - [x] Migration vers @supabase/ssr (createServerClient + createBrowserClient) ‚úÖ
  - [x] Fix getUser() dans middleware (au lieu de getSession()) ‚úÖ
  - [x] Fix window.location.href pour refresh cookies apr√®s login ‚úÖ

**Layout Conditionnel**
- [x] Composant `<Header>` adaptatif ‚úÖ
  - [x] Org member : navigation compl√®te (Dashboard, Projects, Contacts, Team) ‚úÖ
  - [x] Project guest : navigation minimale (logo + user menu uniquement) ‚úÖ
  - [x] Badge projet pour guests : "Guest Access: [Nom]" ‚úÖ
  - [x] Masquage barre recherche pour guests ‚úÖ
  - [x] Masquage bouton "New Project" pour guests ‚úÖ
- [x] Hook `useUserAccess()` cr√©√© pour faciliter utilisation ‚úÖ
- [x] Header simplifi√© pour guests sans authentification ‚úÖ

**Restrictions UI/UX Invit√©s Projet**
- [x] Page `/projects/[id]` - Mode lecture seule pour viewers ‚úÖ
  - [x] Masquer call sheets du canvas (filter items) ‚úÖ
  - [x] D√©sactiver boutons upload/delete/rename ‚úÖ
  - [x] Tools sidebar : masquer "New Call Sheet" ‚úÖ
  - [x] Context menu : seulement "Download" (pas Delete/Rename) ‚úÖ
  - [x] Preview sidebar : masquer bouton "Delete", garder "Download" ‚úÖ
  - [x] Empty state informatif dans Tools sidebar ‚úÖ
- [x] Badge visuel "üîí Read-Only Access" dans header projet ‚úÖ
- [x] Hook `useProjectAccess(projectId)` pour permissions ‚úÖ
- [x] Props `isReadOnly` propag√©es √† tous les composants ‚úÖ
- [x] Team sidebar : afficher membres mais masquer "Invite" ‚úÖ
- [x] D√©sactivation drag & drop en mode lecture seule ‚úÖ

**RLS & Permissions Backend**
- [x] Migration SQL `20241017000002_guest_access_rls.sql` cr√©√©e ‚úÖ
- [x] Policy `project_files` : Viewers SELECT only, Editors/Owners modify ‚úÖ
- [x] Policy `project_folders` : Viewers SELECT only, Editors/Owners modify ‚úÖ
- [x] Policy `call_sheets` : AUCUN acc√®s guests (org members ONLY) ‚úÖ
- [x] Policy `project_members` : Permissions bas√©es sur r√¥le ‚úÖ
- [x] **Fix r√©cursion infinie RLS** : Policies simplifi√©es sans d√©pendances circulaires ‚úÖ
- [x] Tests : tentative upload/delete en tant que viewer ‚Üí bloqu√© c√¥t√© frontend ‚úÖ

**Call Sheets Visibility**
- [x] Invit√©s projet (viewers) : ‚úÖ
  - [x] ‚ùå Ne voient PAS les call sheets sur le canvas (filtr√©s c√¥t√© frontend) ‚úÖ
  - [x] ‚ùå N'ont PAS acc√®s √† `/call-sheets/[id]/edit` (RLS bloque SELECT) ‚úÖ
  - [x] ‚úÖ Peuvent voir les PDFs g√©n√©r√©s (fichiers normaux dans project_files) ‚úÖ
- [x] Membres org : ‚úÖ
  - [x] ‚úÖ Voient tout (call sheets + PDFs) ‚úÖ
  - [x] ‚úÖ Acc√®s √©diteur complet ‚úÖ

**Invitations Projet Guest**
- [x] Modal "Invite Project Member" avec email + r√¥le (Owner/Editor/Viewer) ‚úÖ
- [x] G√©n√©ration token unique + stockage dans `project_members` ‚úÖ
- [x] Email invitation via Postmark (API route `/api/invitations/project`) ‚úÖ
- [x] Page acceptation `/invite/[token]` pour acc√®s direct sans compte ‚úÖ
- [x] Stockage `guest_token_[projectId]` dans localStorage ‚úÖ
- [x] Validation token guest dans `useProjectAccess` hook ‚úÖ
- [x] Service `validateGuestInvitation()` pour v√©rifier token sans auth ‚úÖ
- [x] Liste invitations en attente avec bouton "Revoke" ‚úÖ
- [x] Suppression membres projet avec permissions (sauf owners) ‚úÖ

**Tests End-to-End**
- [x] Sc√©nario complet Victor ‚Üí Philippe (projet) ‚úÖ
  1. [x] Victor cr√©e projet "Shooting Nike" ‚úÖ
  2. [x] Victor invite philippe@gmail.com (role: viewer) ‚úÖ
  3. [x] Philippe re√ßoit email, clique lien ‚úÖ
  4. [x] Philippe acc√®de au projet UNIQUEMENT (sans compte) ‚úÖ
  5. [x] Philippe voit fichiers/dossiers, peut t√©l√©charger ‚úÖ
  6. [x] Philippe ne voit PAS : call sheets, dashboard, autres projets ‚úÖ
  7. [x] Philippe ne peut PAS : upload, delete, rename ‚úÖ
- [x] Tests permissions backend (RLS policies sans r√©cursion) ‚úÖ
- [x] Tests acc√®s liste projets pour membres org ‚úÖ
- [x] Tests cr√©ation projet sans erreur RLS ‚úÖ

**üèÜ Victoires Majeures**
- ‚úÖ **5+ it√©rations RLS** pour casser la r√©cursion infinie
- ‚úÖ **Acc√®s guest anonyme** sans cr√©ation de compte
- ‚úÖ **Permissions granulaires** frontend + backend
- ‚úÖ **Logs d√©taill√©s** pour debugging RLS
- ‚úÖ **Mode lecture seule** complet et coh√©rent

---

### üöÄ **PHASE 6 : FINITIONS & D√âPLOIEMENT (Semaines 11-12)**

#### **Polish & UX**

**üé® Interface Finale**
- [ ] Design coh√©rent sur toutes les pages
- [ ] √âtats de chargement (skeletons)
- [ ] Messages d'erreur utilisateur-friendly
- [ ] Responsive design (desktop priority)

**üìä Observabilit√©**
- [ ] Configuration Sentry (front + server)
- [ ] M√©triques PostHog/Plausible :
  - [ ] `call_sheet_created`
  - [ ] `pdf_generated` 
  - [ ] `email_sent`
  - [ ] `csv_imported`
  - [ ] `file_uploaded`
  - [ ] `member_invited`

**üß™ Tests Utilisateurs**
- [ ] Tests avec 3-5 utilisateurs r√©els
- [ ] Sc√©nario complet : projet ‚Üí upload fichiers ‚Üí invite team ‚Üí call sheet ‚Üí PDF ‚Üí email
- [ ] Corrections bugs critiques
- [ ] Validation convergence preview/PDF

#### **D√©ploiement Production**

**üåê D√©ploiement Web**
- [ ] Configuration Vercel/Fly.io pour app web
- [ ] Variables d'environnement production
- [ ] Domaine personnalis√©
- [ ] SSL/HTTPS

**üê≥ D√©ploiement Service PDF**
- [ ] Deploy service PDF sur Fly.io
- [ ] Configuration scaling (min=1, max=3)
- [ ] Health checks et monitoring
- [ ] Tests de charge (10 PDF simultan√©s)

**üìß Configuration Email**
- [ ] Domaine d'envoi configur√©
- [ ] SPF/DKIM/DMARC records
- [ ] Templates Postmark finalis√©s (call sheet + invitations)
- [ ] Tests d'envoi en production

**üíæ Storage & Quotas**
- [ ] Configuration limites Supabase Storage
- [ ] Monitoring utilisation par projet
- [ ] Alertes quotas (90% utilis√©s)
- [ ] Plan upgrade storage si besoin

---

## üéØ ACCEPTANCE CRITERIA MVP

### **Sc√©nario Utilisateur Complet**
- [x] **Inscription** : Cr√©er compte + organisation
- [ ] **Projet** : Cr√©er un nouveau projet
- [x] **Contacts** : Ajouter 5 contacts manuellement ‚úÖ CRUD complet
- [ ] **Import** : Importer 10 contacts via CSV
- [x] **Call Sheet** : Cr√©er call sheet compl√®te (infos + planning + √©quipe) ‚úÖ √âditeur complet
- [x] **Preview** : V√©rifier rendu A4 temps r√©el ‚úÖ Convergence valid√©e
- [x] **PDF** : G√©n√©rer PDF en < 10 secondes ‚úÖ Service fonctionnel
- [x] **Email** : Envoyer √† l'√©quipe avec PDF ‚úÖ Postmark int√©gr√©
- [ ] **Duplication** : Dupliquer pour "Jour 2"

### **Crit√®res Techniques**
- [ ] **Convergence** : < 2mm diff√©rence preview/PDF
- [ ] **Performance** : LCP < 2.5s sur √©diteur
- [ ] **S√©curit√©** : RLS test√© avec 2 organisations distinctes
- [ ] **Fiabilit√©** : 95% emails d√©livr√©s (Postmark)
- [ ] **Responsive** : Utilisable sur tablette (iPad)

### **Crit√®res Business**
- [ ] **Onboarding** : < 5 minutes pour premi√®re call sheet
- [ ] **Qualit√© PDF** : Imprimable professionnellement
- [ ] **Import CSV** : > 90% succ√®s sur formats standards
- [ ] **Uptime** : 99% disponibilit√© service PDF

---

## üìö DOCUMENTATION TECHNIQUE

### **Architecture**
- [ ] Sch√©ma architecture (diagramme)
- [ ] Documentation API interne
- [ ] Guide d√©ploiement
- [ ] Runbook incidents

### **D√©veloppement**
- [ ] README avec setup local
- [ ] Guide contribution
- [ ] Standards code (ESLint + Prettier)
- [ ] Tests automatis√©s (CI/CD)

---

## üîÑ SUIVI & M√âTRIQUES

### **KPIs D√©veloppement**
- [ ] **V√©locit√©** : Stories/semaine
- [ ] **Qualit√©** : Bugs/fonctionnalit√©  
- [ ] **Performance** : Temps g√©n√©ration PDF
- [ ] **Tests** : Couverture code > 70%

### **KPIs Produit (Post-Launch)**
- [ ] **Adoption** : Call sheets cr√©√©es/semaine
- [ ] **Engagement** : Projets actifs/utilisateur
- [ ] **Satisfaction** : NPS > 50
- [ ] **Technique** : Uptime > 99%

---

## üìû CONTACTS & RESSOURCES

### **Services Externes**
- **Supabase** : Base de donn√©es + Auth + Storage
- **Fly.io** : H√©bergement service PDF
- **Postmark** : Envoi emails transactionnels
- **Sentry** : Monitoring erreurs
- **PostHog/Plausible** : Analytics produit

### **Outils D√©veloppement**
- **Cursor** : IDE principal
- **GitHub** : Versioning + CI/CD
- **Figma** : Designs UI (si n√©cessaire)
- **Notion** : Documentation projet

---

> **üéØ Objectif Final** : Une plateforme collaborative compl√®te pour productions audiovisuelles, permettant de g√©rer projets, fichiers, √©quipes et call sheets dans un hub cloud centralis√©. L'utilisateur peut cr√©er des call sheets professionnelles, partager des documents avec son √©quipe, et inviter des collaborateurs en quelques clics.

**Derni√®re mise √† jour** : 17 octobre 2025  
**Version** : 2.6 (Multi-Level Access Control Edition)  
**Statut** : ‚úÖ Phase 5 COMPL√àTEMENT TERMIN√âE - üéØ Phase 6 (Finitions) - **98% MVP V1 TERMIN√â !**
