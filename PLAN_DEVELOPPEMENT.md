# üìã PLAN DE D√âVELOPPEMENT - SaaS Call Sheets MVP

> **Objectif** : Construire un MVP fiable permettant de cr√©er, √©diter et envoyer des call sheets professionnelles en PDF
> 
> **Timeline** : 8 semaines | **Stack** : Next.js 15.5 + Supabase + Fly.io + Postmark + Tailwind

---

## üéØ R√àGLES D'OR DU PROJET

- ‚úÖ **Convergence Preview/PDF** : M√™mes composants, m√™mes CSS, m√™mes fonts
- ‚úÖ **Simplicit√© avant tout** : 1 template parfait > 4 moyens
- ‚úÖ **Tests pr√©coces** : Validation utilisateur d√®s la semaine 4
- ‚úÖ **Performance** : PDF g√©n√©r√© en < 10 secondes
- ‚úÖ **S√©curit√©** : RLS strict, URLs sign√©es, tokens courts

---

## üìà √âTAT D'AVANCEMENT GLOBAL

| Phase | Statut | Progression | Fonctionnalit√©s Cl√©s | Date Ach√®vement |
|-------|---------|-------------|----------------------|------------------|
| **Phase 1** | ‚úÖ **Termin√©e** | 100% | Fondations + Auth + UI Base | ‚úÖ Semaine 2 |
| **Phase 2** | ‚úÖ **Termin√©e** | 100% | √âditeur + Preview + Auto-save | ‚úÖ Semaine 4 |
| **Phase 3** | ‚úÖ **Termin√©e** | 95% | PDF + Email + Finalisation | ‚úÖ Semaine 5 |
| **Phase 4** | ‚úÖ **Termin√©e** | 100% | **Contacts CRUD + Int√©gration** | ‚úÖ Semaine 6 |
| **Phase 5** | ‚è≥ √Ä venir | 0% | Finitions + D√©ploiement | üéØ Semaine 8 |

### üéØ **PROGRESSION TOTALE MVP : ~95% TERMIN√â**

**‚úÖ Phase 4 TERMIN√âE ! Derniers succ√®s :**
- ‚úÖ Interface contacts avec toggle Card/Liste
- ‚úÖ CRUD complet (Create, Update, Delete) 
- ‚úÖ Modal s√©lection contacts dans √©diteur
- ‚úÖ Boutons "üìá R√©pertoire" fonctionnels
- ‚úÖ S√©lection multiple de contacts
- ‚úÖ Preview √©quipe tri√©e par d√©partements
- ‚úÖ **Import CSV avec drag & drop**
- ‚úÖ **Parsing avec validation et d√©duplication**
- ‚úÖ **Rapport d'import d√©taill√©**

**üöß Prochaines √©tapes (Phase 5) :**
- Polish & UX finitions
- Tests utilisateurs  
- D√©ploiement production

---

## üìä PHASES DE D√âVELOPPEMENT

### üèóÔ∏è **PHASE 1 : FONDATIONS (Semaines 1-2)**

#### **Semaine 1 : Setup Projet & Infrastructure**

**üîß Initialisation**
- [x] ~~Cr√©er le monorepo `callsheets-app`~~ ‚Üí **Simplifi√© :** Structure directe dans `calltimes/`
  - [x] ~~`apps/web` (Next.js 15.5)~~ ‚Üí **D√©plac√© :** Application Next.js √† la racine `calltimes/`
  - [ ] `services/pdf-renderer` (Node + Playwright) ‚Üí **√Ä cr√©er plus tard**
- [x] Initialiser Next.js avec App Router + TypeScript
- [x] Installer les d√©pendances principales :
  - [x] `tailwindcss` + `@tailwindcss/typography`
  - [x] `shadcn/ui` (Card, Button, Input, Table, Dialog)
  - [x] `react-hook-form` + `zod`
  - [x] `@supabase/ssr` + `@supabase/supabase-js`
  - [x] `@sentry/nextjs`
  - [x] `react-email` + `@react-email/components`

**üé® Configuration UI**
- [x] Setup Tailwind avec config print CSS
- [x] Installer shadcn/ui avec th√®me sobre
- [x] Cr√©er les tokens CSS pour impression (marges A4, fonts)
- [x] Composant `<A4Page>` de base avec marges fixes

**üîí Supabase Setup**
- [x] Cr√©er projet Supabase
- [x] Configurer Auth (email + magic link)
- [x] Cr√©er buckets Storage : `org-logos`, `project-assets`, `pdfs`
- [x] Variables d'environnement `.env.local`

#### **Semaine 2 : Base de Donn√©es & Auth**

**üóÑÔ∏è Migrations SQL**
- [x] Table `organizations`
- [x] Table `users` 
- [x] Table `memberships` (multi-tenant)
- [x] Table `projects`
- [x] Table `contacts` (simplifi√© sans cat√©gories)
- [x] Table `call_sheets`
- [x] Table `call_sheet_locations`
- [x] Table `call_sheet_schedule`
- [x] Table `call_sheet_team_rows`
- [x] Table `email_jobs` + `email_recipients`

**üîê S√©curit√© RLS**
- [x] Policies RLS pour toutes les tables
- [x] Tests RLS (utilisateur ne voit que son org)
- [x] Helper functions Supabase (get_user_org_id)

**üå± Seeds & Tests**
- [x] Donn√©es de test (orgs, users, contacts)
- [x] Tests auth basiques (signup/login avec mot de passe)
- [x] Flow d'onboarding pour cr√©ation d'organisation
- [ ] Validation des policies RLS

**üì± Shell UI**
- [x] Layout principal avec navigation
- [x] Page `/dashboard` (shell avec donn√©es mock√©es)
- [x] Page `/projects` (MISSION CONTROL avec grille projets + filtres statuts)
- [x] Page `/contacts` (CONTACT DIRECTORY avec filtres d√©partements + recherche)
- [x] Composants UI de base (Header, Sidebar, PageLayout, GridLayout, SectionHeader)
- [x] **Structure simplifi√©e :** Tout d√©plac√© de `apps/web/` vers `calltimes/` directement
- [x] **Application fonctionnelle :** Dashboard accessible sur http://localhost:3000
- [x] **Design System Appliqu√© :** Vocabulaire "command", couleurs fonctionnelles par section
- [x] **Authentification compl√®te :** Signup, Login, Onboarding, Middleware protection
- [x] **Multi-tenant ready :** Organisation auto-cr√©ation, RLS policies actives

---

### ‚úèÔ∏è **PHASE 2 : √âDITEUR & PREVIEW (Semaines 3-4)**

#### **Semaine 3 : √âditeur Core**

**üìù Structure √âditeur**
- [x] Page `/call-sheets/[id]/edit`
- [x] Layout √©diteur : sidebar gauche + preview droite
- [x] Composant `<EditorSidebar>` avec 4 sections :
  - [x] **Section 1** : Informations G√©n√©rales
  - [x] **Section 2** : Planning  
  - [x] **Section 3** : √âquipe
  - [x] **Section 4** : Param√®tres

**üìã Section Informations G√©n√©rales**
- [x] Formulaire React Hook Form + Zod
- [x] Champs : titre, date de tournage, description
- [x] **Gestion des lieux avanc√©e** : Multi-lieux avec nom + adresse + notes
- [x] **Contacts importants** : Cards avec nom + poste + tel + email
- [x] **Interface triple logos** : Production (gauche) + Marque (centre, plus gros) + Agence (droite)
- [x] Notes g√©n√©rales

**‚è∞ Section Planning**
- [x] Liste des horaires (titre + heure texte libre)
- [x] **Quick adds intelligents** : Boutons pr√©d√©finis avec heures sugg√©r√©es
- [x] **Cards √©ditables compl√®tes** : Titre ET heure modifiables
- [x] **Tri automatique par heure** : R√©organisation temps r√©el
- [x] **Validation Zod temps r√©el** : Format HH:MM avec messages d'erreur
- [x] **Boutons Up/Down** : R√©organisation manuelle sans drag & drop
- [x] Boutons Ajouter/Supprimer

#### **Semaine 4 : Preview A4 & √âquipe**

**üë• Section √âquipe**
- [x] **Gestion avanc√©e par d√©partements** : 9 cat√©gories avec couleurs
- [x] **Organisation automatique** : Tri et groupement par d√©partement
- [x] **Ajout manuel complet** : Formulaire 6 champs (nom, poste, dept, call time, tel, email)
- [x] **Boutons r√©pertoire fonctionnels** : Ouverture page contacts en nouvel onglet
- [x] **Boutons Up/Down** : R√©organisation manuelle de l'√©quipe
- [x] **Codes couleur professionnels** : PROD, REGIE, CAM, REAL, HMC, etc.
- [x] Champs : nom, r√¥le, email, t√©l√©phone, call time, d√©partement

**üìÑ Preview A4 Temps R√©el**
- [x] **Template professionnel final** : Header √©pur√© avec 3 logos positionn√©s
- [x] **Structure logique optimis√©e** : Titre ‚Üí Date ‚Üí Lieux ‚Üí Contacts ‚Üí Planning ‚Üí √âquipe ‚Üí Notes
- [x] **CSS print optimis√©** : Marges, typographie, compacit√© PDF
- [x] **Rendu temps r√©el complet** : Toutes sections synchronis√©es
- [x] **Police syst√®me fixe** : Design √©pur√© et professionnel
- [x] **Synchronisation temps r√©el** : Preview se met √† jour instantan√©ment
- [x] **Section CREW CALL dynamique** : Affichage √©quipe par d√©partement
- [ ] Tests multi-navigateurs (Chrome, Firefox, Safari)

**üíæ Auto-Save**
- [x] **Hook `useAutoSave` professionnel** : Debounce 500ms + gestion d'erreurs
- [x] **Sauvegarde automatique** : Mock avec simulation d√©lai (pr√™t pour vraie API)
- [x] **Indicateur de statut dynamique** : Sauvegard√©/En cours/Erreur avec couleurs

**üß™ Tests Convergence**
- [x] Prototype PDF simple pour validation
- [x] Comparaison visuelle preview vs PDF
- [x] Ajustements CSS si n√©cessaire

---

### üìÑ **PHASE 3 : PDF & EMAIL (Semaine 5)**

#### **Service PDF (Fly.io)**

**üê≥ Setup Service**
- [x] Dockerfile pour service PDF (Node + Playwright)
- [x] Configuration Fly.io (`fly.toml`)
- [x] Endpoint `/render?token=...&callSheetId=...`
- [x] **Mode d√©mo fonctionnel** : Fallback avec donn√©es de test + t√©l√©chargement direct
- [ ] Validation token sign√© + TTL (15 minutes)

**üé≠ G√©n√©ration PDF**
- [x] Fetch donn√©es call sheet (Supabase service key)
- [x] Rendu HTML avec m√™mes composants que preview
- [x] Configuration Chromium (A4, marges 12mm)
- [x] Upload PDF vers bucket `pdfs/` (mode production)
- [x] **Convergence Preview/PDF valid√©e** : Diff√©rences < 5% (donn√©es uniquement)
- [x] **T√©l√©chargement automatique** : PDF se t√©l√©charge directement en mode d√©mo

**üìß Int√©gration Email**
- [x] Configuration Postmark (domaine + templates)
- [x] Page `/finalize/[callSheetId]`
- [x] Formulaire envoi : objet, message, destinataires auto
- [x] Envoi PDF en pi√®ce jointe
- [x] **Tests validation r√©ussis** : Restriction domaine Postmark confirm√©e (compte pending)
- [ ] Webhook Postmark pour statut

**üîÑ Gestion Erreurs**
- [ ] Retry automatique (3 tentatives)
- [ ] Notifications utilisateur (toast/alert)
- [ ] Logs d'erreur (Sentry)
- [ ] Fallback si service PDF indisponible

---

### üë• **PHASE 4 : CONTACTS & IMPORT (Semaines 6-7)**

#### **Semaine 6 : CRUD Contacts**

**üìá Interface Contacts**
- [x] **Page `/contacts` am√©lior√©e** : Grille cards + vue liste toggle
- [x] **Filtres avanc√©s** : Recherche temps r√©el (nom/email/t√©l√©phone/r√¥le) + d√©partements
- [x] **CRUD complet** : Create, Read, Update, Delete fonctionnels
- [x] **Modal cr√©ation/√©dition** : Formulaire valid√© (Zod + React Hook Form)
- [x] **Validation formulaire** : Email, t√©l√©phone, champs requis
- [x] **Toggle vue Card/Liste** : Basculement interface pour overview rapide
- [x] **Stats dynamiques** : Compteurs temps r√©el, notifications toast

**üîó Int√©gration √âditeur**
- [x] **S√©lection contacts depuis √©diteur** : Modal d√©di√©e avec recherche/filtres
- [x] **Auto-remplissage √©quipe** : Mapping automatique contact ‚Üí membre √©quipe
- [x] **Boutons r√©pertoire fonctionnels** : "üìá R√©pertoire" ouvre modal s√©lection
- [x] **Modes sp√©cialis√©s** : Important contacts vs Team members
- [x] **S√©lection multiple** : Ajout de plusieurs contacts en une fois
- [x] **Interface optimis√©e** : Cards compactes avec badges color√©s
- [x] **Preview am√©lior√©e** : √âquipe tri√©e par d√©partements avec headers gris√©s
- [ ] Conversion ligne manuelle ‚Üí contact permanent
- [ ] Gestion des contacts "favoris" ou r√©cents

#### **Semaine 7 : Import CSV & Projets**

**üìä Import CSV**
- [x] **Interface upload CSV** : Drag & drop avec react-dropzone
- [x] **Format fixe** : `name,role,email,phone` valid√©
- [x] **Parsing avec validation** : Validation temps r√©el des champs
- [x] **D√©duplication par email** : D√©tection automatique des doublons
- [x] **Rapport d'import** : Statistiques d√©taill√©es (cr√©√©s/ignor√©s/erreurs)
- [x] **Template CSV** : T√©l√©chargement de mod√®le pr√©-format√©
- [x] **UX professionnelle** : Interface intuitive avec feedback visuel

**üìÅ Gestion Projets**
- [ ] Page `/projects` avec liste
- [ ] CRUD projets basique
- [ ] Page projet `/projects/[id]` 
- [ ] Liste des call sheets du projet
- [ ] Actions : cr√©er call sheet, dupliquer

**üìã Duplication Call Sheet**
- [ ] Bouton "Dupliquer" sur call sheet existante
- [ ] Copie des donn√©es + date +1 jour
- [ ] Modification possible avant sauvegarde

---

### üöÄ **PHASE 5 : FINITIONS & D√âPLOIEMENT (Semaine 8)**

#### **Polish & UX**

**üé® Interface Finale**
- [ ] Design coh√©rent sur toutes les pages
- [ ] √âtats de chargement (skeletons)
- [ ] Messages d'erreur utilisateur-friendly
- [ ] Responsive design (desktop priority)

**üìä Observabilit√©**
- [ ] Configuration Sentry (front + server)
- [ ] M√©triques PostHog/Plausible :
  - [ ] `call_sheet_created`
  - [ ] `pdf_generated` 
  - [ ] `email_sent`
  - [ ] `csv_imported`

**üß™ Tests Utilisateurs**
- [ ] Tests avec 3-5 utilisateurs r√©els
- [ ] Sc√©nario complet : projet ‚Üí call sheet ‚Üí PDF ‚Üí email
- [ ] Corrections bugs critiques
- [ ] Validation convergence preview/PDF

#### **D√©ploiement Production**

**üåê D√©ploiement Web**
- [ ] Configuration Vercel/Fly.io pour app web
- [ ] Variables d'environnement production
- [ ] Domaine personnalis√©
- [ ] SSL/HTTPS

**üê≥ D√©ploiement Service PDF**
- [ ] Deploy service PDF sur Fly.io
- [ ] Configuration scaling (min=1, max=3)
- [ ] Health checks et monitoring
- [ ] Tests de charge (10 PDF simultan√©s)

**üìß Configuration Email**
- [ ] Domaine d'envoi configur√©
- [ ] SPF/DKIM/DMARC records
- [ ] Templates Postmark finalis√©s
- [ ] Tests d'envoi en production

---

## üéØ ACCEPTANCE CRITERIA MVP

### **Sc√©nario Utilisateur Complet**
- [x] **Inscription** : Cr√©er compte + organisation
- [ ] **Projet** : Cr√©er un nouveau projet
- [x] **Contacts** : Ajouter 5 contacts manuellement ‚úÖ CRUD complet
- [ ] **Import** : Importer 10 contacts via CSV
- [x] **Call Sheet** : Cr√©er call sheet compl√®te (infos + planning + √©quipe) ‚úÖ √âditeur complet
- [x] **Preview** : V√©rifier rendu A4 temps r√©el ‚úÖ Convergence valid√©e
- [x] **PDF** : G√©n√©rer PDF en < 10 secondes ‚úÖ Service fonctionnel
- [x] **Email** : Envoyer √† l'√©quipe avec PDF ‚úÖ Postmark int√©gr√©
- [ ] **Duplication** : Dupliquer pour "Jour 2"

### **Crit√®res Techniques**
- [ ] **Convergence** : < 2mm diff√©rence preview/PDF
- [ ] **Performance** : LCP < 2.5s sur √©diteur
- [ ] **S√©curit√©** : RLS test√© avec 2 organisations distinctes
- [ ] **Fiabilit√©** : 95% emails d√©livr√©s (Postmark)
- [ ] **Responsive** : Utilisable sur tablette (iPad)

### **Crit√®res Business**
- [ ] **Onboarding** : < 5 minutes pour premi√®re call sheet
- [ ] **Qualit√© PDF** : Imprimable professionnellement
- [ ] **Import CSV** : > 90% succ√®s sur formats standards
- [ ] **Uptime** : 99% disponibilit√© service PDF

---

## üìö DOCUMENTATION TECHNIQUE

### **Architecture**
- [ ] Sch√©ma architecture (diagramme)
- [ ] Documentation API interne
- [ ] Guide d√©ploiement
- [ ] Runbook incidents

### **D√©veloppement**
- [ ] README avec setup local
- [ ] Guide contribution
- [ ] Standards code (ESLint + Prettier)
- [ ] Tests automatis√©s (CI/CD)

---

## üîÑ SUIVI & M√âTRIQUES

### **KPIs D√©veloppement**
- [ ] **V√©locit√©** : Stories/semaine
- [ ] **Qualit√©** : Bugs/fonctionnalit√©  
- [ ] **Performance** : Temps g√©n√©ration PDF
- [ ] **Tests** : Couverture code > 70%

### **KPIs Produit (Post-Launch)**
- [ ] **Adoption** : Call sheets cr√©√©es/semaine
- [ ] **Engagement** : Projets actifs/utilisateur
- [ ] **Satisfaction** : NPS > 50
- [ ] **Technique** : Uptime > 99%

---

## üìû CONTACTS & RESSOURCES

### **Services Externes**
- **Supabase** : Base de donn√©es + Auth + Storage
- **Fly.io** : H√©bergement service PDF
- **Postmark** : Envoi emails transactionnels
- **Sentry** : Monitoring erreurs
- **PostHog/Plausible** : Analytics produit

### **Outils D√©veloppement**
- **Cursor** : IDE principal
- **GitHub** : Versioning + CI/CD
- **Figma** : Designs UI (si n√©cessaire)
- **Notion** : Documentation projet

---

> **üéØ Objectif Final** : Un MVP fonctionnel permettant de cr√©er et envoyer des call sheets professionnelles en moins de 5 minutes, avec une qualit√© PDF impeccable et une UX fluide.

**Derni√®re mise √† jour** : 29 septembre 2025  
**Version** : 1.2  
**Statut** : üöß Phase 4 en cours - 85% termin√©
